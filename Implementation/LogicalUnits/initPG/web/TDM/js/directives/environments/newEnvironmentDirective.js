function newEnvironmentDirective(){return{restrict:"E",templateUrl:"views/environments/newEnvironment.html",scope:{content:"="},controller:function($scope,TDMService,BreadCrumbsService,toastr,$timeout,AuthService){var newEnvironmentCtrl=this;newEnvironmentCtrl.envTypes=["Both","Source","Target"],newEnvironmentCtrl.syncModes=[{text:"Do not Sync",value:"OFF"},{text:"Always Sync",value:"FORCE"}],newEnvironmentCtrl.environments=$scope.content.environments,TDMService.getFabricRoles("owner").then(response=>{newEnvironmentCtrl.userGroups=response.result}),newEnvironmentCtrl.envType="Target",newEnvironmentCtrl.environmentData={allow_write:!0,allow_read:!1,owners:[],mask_sensitive_data:!0},newEnvironmentCtrl.envTypeChanged=function(){newEnvironmentCtrl.envType&&("target"==newEnvironmentCtrl.envType.toLowerCase()?(newEnvironmentCtrl.environmentData.allow_write=!0,newEnvironmentCtrl.environmentData.allow_read=!1):"source"==newEnvironmentCtrl.envType.toLowerCase()?(newEnvironmentCtrl.environmentData.allow_write=!1,newEnvironmentCtrl.environmentData.allow_read=!0):"both"==newEnvironmentCtrl.envType.toLowerCase()&&(newEnvironmentCtrl.environmentData.allow_write=!0,newEnvironmentCtrl.environmentData.allow_read=!0,newEnvironmentCtrl.environmentData.mask_sensitive_data=!1))},TDMService.getGenericAPI("wsGetAllEnvs").then((function(response){newEnvironmentCtrl.availableSourceEnvironments=_.filter(response.result,(function(env){return!(_.findIndex(newEnvironmentCtrl.environments,{environment_name:env,environment_status:"Active"})>=0)}))})).catch((function(err){toastr.error("New Environment","Unable to get available Source Environment")})),TDMService.getUsersByPermssionGroups("owner").then((function(response){"SUCCESS"==response.errorCode?newEnvironmentCtrl.allOwners=_.map(response.result,item=>(item.user_type||(item.user_type="ID"),item)):(toastr.error("New Environment","failed to get owners: "+response.message),newEnvironmentCtrl.allOwners=[])})),newEnvironmentCtrl.addOwner=function(newOwner){newOwner&&(newEnvironmentCtrl.environmentData.owners||(newEnvironmentCtrl.environmentData.owners=[]),_.findIndex(newEnvironmentCtrl.environmentData.owners,{user_id:newOwner})>=0?newEnvironmentCtrl.addOwnerError=!0:(newEnvironmentCtrl.environmentData.owners.push({displayName:newOwner,uid:newOwner,user_id:newOwner,username:newOwner}),newEnvironmentCtrl.allOwners.push({displayName:newOwner,uid:newOwner,user_id:newOwner,username:newOwner}),newEnvironmentCtrl.isOpen=!1))},newEnvironmentCtrl.initAddNewOwnerPopup=function(){newEnvironmentCtrl.isOpen=!newEnvironmentCtrl.isOpen},newEnvironmentCtrl.closeAddOwnerModal=()=>{newEnvironmentCtrl.isOpen=!1},newEnvironmentCtrl.saveUsersAndGroups=(user,userCustom,userGroup)=>{if(user){const newUser=angular.copy(user);newUser.user_type="ID",newEnvironmentCtrl.environmentData.owners.push(newUser)}userCustom&&(newEnvironmentCtrl.environmentData.owners.push({user_id:userCustom,user_name:userCustom,username:userCustom,user_type:"ID"}),newEnvironmentCtrl.allOwners.push({user_id:userCustom,user_name:userCustom,username:userCustom,user_type:"ID"})),userGroup&&(newEnvironmentCtrl.environmentData.owners.push({user_id:userGroup,user_name:userGroup,username:userGroup,user_type:"GROUP",group:!0}),newEnvironmentCtrl.allOwners.push({user_id:userGroup,user_name:userGroup,username:userGroup,user_type:"GROUP",group:!0})),newEnvironmentCtrl.isOpen=!1},newEnvironmentCtrl.addEnvironment=function(){return newEnvironmentCtrl.environmentData.allow_write||newEnvironmentCtrl.environmentData.allow_read?_.find(newEnvironmentCtrl.environments,{environment_name:newEnvironmentCtrl.environmentData.environment_name,environment_status:"Active"})?toastr.error("Environment # "+newEnvironmentCtrl.environmentData.environment_name+" Already Exists"):void TDMService.addEnvironment(newEnvironmentCtrl.environmentData).then((function(response){"SUCCESS"==response.errorCode?(TDMService.getEnvironment(response.result.id).then((function(response){$timeout((function(){response.result[0].owners=[],response.result[0].user_name=null,$scope.content.openEnvironment(response.result[0])}),300)})),toastr.success("Environment # "+newEnvironmentCtrl.environmentData.environment_name,"Created Successfully")):toastr.error("Environment # "+newEnvironmentCtrl.environmentData.environment_name,"Unable to Create : "+response.message)})):toastr.error("Environment must be Target or Source Environment")},BreadCrumbsService.push({},"NEW_ENVIRONMENT",(function(){}))},controllerAs:"newEnvironmentCtrl"}}angular.module("TDM-FE").directive("newEnvironmentDirective",newEnvironmentDirective);