function taskStatsDirective(){return{restrict:"E",templateUrl:"views/tasks/executionStats.html",scope:{content:"="},link:function(scope,element,attrs){element.on("$destroy",(function(){angular.element("body").on("search.dt",null)}))},controller:function($scope,$filter,TDMService,BreadCrumbsService,$element,$uibModal,toastr,$timeout,AuthService,$state,DTColumnBuilder,DTOptionsBuilder,$q,$compile,$rootScope){var taskStatesCtrl=this;taskStatesCtrl.taskData=$scope.content.taskData,taskStatesCtrl.tab=1,taskStatesCtrl.tasksExecID=$scope.$parent.$parent.tasks.tasksData.taskExecId,taskStatesCtrl.fabricExecID=$scope.$parent.$parent.tasks.tasksData.fabricExecutionId,taskStatesCtrl.type=$scope.$parent.$parent.tasks.tasksData.type,taskStatesCtrl.selectionMethod=$scope.$parent.$parent.tasks.tasksData.selectionMethod,taskStatesCtrl.refcount=$scope.$parent.$parent.tasks.tasksData.refCount,taskStatesCtrl.loadingTableFailedReferences=!0,taskStatesCtrl.loadingTableFailedEntities=!0,taskStatesCtrl.loadingTableCopiedEntities=!0,taskStatesCtrl.loadingTableCopiedReferences=!0,BreadCrumbsService.push({tasksExecID:taskStatesCtrl.tasksExecID},"STATISTICS",(function(){})),$scope.luTreeMenu=[],taskStatesCtrl.makeCopiedReferenceTable=function(isRoot,refreshData){if(refreshData&&taskStatesCtrl.dtInstancecReferences&&taskStatesCtrl.dtInstancecReferences.reloadData)taskStatesCtrl.dtInstancecReferences.reloadData((function(data){}),!1);else{taskStatesCtrl.dtInstancecReferences={},taskStatesCtrl.dtColumnscReferences=[],taskStatesCtrl.dtColumnDefscReferences=[],taskStatesCtrl.headerscReferences=[{column:"RerernceTableName",name:"Table name",clickAble:!1},{column:"RerernceTableCount",name:"Number of records",clickAble:!1}];for(var i=0;i<taskStatesCtrl.headerscReferences.length;i++)taskStatesCtrl.dtColumnscReferences.push(DTColumnBuilder.newColumn(taskStatesCtrl.headerscReferences[i].column).withTitle(taskStatesCtrl.headerscReferences[i].name));var getTableData=function(){var deferred=$q.defer();return deferred.resolve(taskStatesCtrl.cReferences),deferred.promise};taskStatesCtrl.openStatsModal=targetId=>{taskStatesCtrl.popUpTreeMenu=[];var taskExecutionId=taskStatesCtrl.tasksExecID,luName=taskStatesCtrl.selectedLU.lu_name;$uibModal.open({template:'<task-stats-modal-directive\n                                ng-if="targetId"\n                                task-execution-id="taskExecutionId" \n                                target-id="targetId"\n                                close="close"\n                                update-popup="update"\n                                lu-name="luName"></task-stats-modal-directive>',size:"modal-x-lg",windowClass:"staticsModal",resolve:{},controller:function($scope,$uibModalInstance){$scope.taskExecutionId=taskExecutionId,$scope.targetId=targetId,$scope.luName=luName,$scope.update=function(newTargetId,newLU){$scope.targetId=null,$timeout((function(){$scope.targetId=newTargetId,$scope.luName=newLU}),100)},$scope.close=function(){$uibModalInstance.close()}},controllerAs:"staticsModalCtrl"})},taskStatesCtrl.dtOptionscReferences=DTOptionsBuilder.fromFnPromise((function(){return getTableData()})).withDOM("lTfgitp").withOption("createdRow",(function(row){$compile(angular.element(row).contents())($scope)})).withOption("scrollX",!1).withOption("lengthChange",!0).withOption("paging",!0).withOption("searching",!0).withOption("info",!0).withOption("caseInsensitive",!0).withOption("search",{caseInsensitive:!1}),taskStatesCtrl.dtInstanceCallbackcReferences=function(dtInstance){angular.isFunction(taskStatesCtrl.dtInstancecReferences)?taskStatesCtrl.dtInstancecReferences(dtInstance):angular.isDefined(taskStatesCtrl.dtInstancecReferences)&&(taskStatesCtrl.dtInstancecReferences=dtInstance)},null!=taskStatesCtrl.dtInstancecReferences.changeData&&taskStatesCtrl.dtInstancecReferences.changeData(getTableData()),taskStatesCtrl.loadingTableCopiedReferences=!1}},taskStatesCtrl.makeCopiedEntitiesTable=function(isRoot,refreshData){if(refreshData&&taskStatesCtrl.dtInstancecEntities&&taskStatesCtrl.dtInstancecEntities.reloadData)return void taskStatesCtrl.dtInstancecEntities.reloadData((function(data){}),!1);taskStatesCtrl.dtInstancecEntities={},taskStatesCtrl.dtColumnscEntities=[],taskStatesCtrl.dtColumnDefscEntities=[],taskStatesCtrl.headerscEntities=isRoot?[{column:"sourceId",name:"Source id",clickAble:!0},{column:"targetId",name:"Target id",clickAble:!1}]:[{column:"sourceId",name:"Source id",clickAble:!0},{column:"targetId",name:"Target id",clickAble:!1},{column:"parentLuName",name:"Parent LU Name",clickAble:!1},{column:"parentSourceId",name:"Parent Source ID",clickAble:!1},{column:"parentTargetId",name:"Parent Target ID",clickAble:!1}];let clickableCol=(data,type,full)=>`<a ng-click="taskStatesCtrl.openStatsModal('${full.targetId}')">  ${data} </a>`;for(var i=0;i<taskStatesCtrl.headerscEntities.length;i++)taskStatesCtrl.headerscEntities[i].clickAble?taskStatesCtrl.dtColumnscEntities.push(DTColumnBuilder.newColumn(taskStatesCtrl.headerscEntities[i].column).withTitle(taskStatesCtrl.headerscEntities[i].name).renderWith(clickableCol)):taskStatesCtrl.dtColumnscEntities.push(DTColumnBuilder.newColumn(taskStatesCtrl.headerscEntities[i].column).withTitle(taskStatesCtrl.headerscEntities[i].name));var getTableData=function(){var deferred=$q.defer();return deferred.resolve(taskStatesCtrl.cEntities),deferred.promise};taskStatesCtrl.dtOptionscEntities=DTOptionsBuilder.fromFnPromise((function(){return getTableData()})).withDOM("lTfgitp").withOption("createdRow",(function(row){$compile(angular.element(row).contents())($scope)})).withOption("scrollX",!1).withOption("lengthChange",!0).withOption("paging",!0).withOption("searching",!0).withOption("info",!0).withOption("caseInsensitive",!0).withOption("search",{caseInsensitive:!1}),taskStatesCtrl.dtInstanceCallbackcEntities=function(dtInstance){angular.isFunction(taskStatesCtrl.dtInstancecEntities)?taskStatesCtrl.dtInstancecEntities(dtInstance):angular.isDefined(taskStatesCtrl.dtInstancecEntities)&&(taskStatesCtrl.dtInstancecEntities=dtInstance)},null!=taskStatesCtrl.dtInstancecEntities.changeData&&taskStatesCtrl.dtInstancecEntities.changeData(getTableData()),taskStatesCtrl.loadingTableCopiedEntities=!1,taskStatesCtrl.dtInstancecEntities&&taskStatesCtrl.dtInstancecEntities.reloadData&&taskStatesCtrl.dtInstancecEntities.reloadData((function(data){}),!1)},taskStatesCtrl.makeFailedReferenceTable=function(isRoot,refreshData){if(refreshData&&taskStatesCtrl.dtInstancefReferences&&taskStatesCtrl.dtInstancefReferences.reloadData)return void taskStatesCtrl.dtInstancefReferences.reloadData((function(data){}),!1);taskStatesCtrl.dtInstancefReferences={},taskStatesCtrl.dtColumnsfReferences=[],taskStatesCtrl.dtColumnDefsfReferences=[],taskStatesCtrl.headersfReferences=[{column:"RerernceTableName",name:"Table name",clickAble:!1},{column:"errorMsg",name:"Error Message",clickAble:!1}];let errorMsgCol=(data,type,full)=>`<div style="white-space:pre-line;user-select: text;">${data}</div>`;for(var i=0;i<taskStatesCtrl.headersfReferences.length;i++){"errorMsg"===taskStatesCtrl.headersfReferences[i].column?taskStatesCtrl.dtColumnsfReferences.push(DTColumnBuilder.newColumn(taskStatesCtrl.headersfReferences[i].column).withTitle(taskStatesCtrl.headersfReferences[i].name).renderWith(errorMsgCol)):taskStatesCtrl.dtColumnsfReferences.push(DTColumnBuilder.newColumn(taskStatesCtrl.headersfReferences[i].column).withTitle(taskStatesCtrl.headersfReferences[i].name).withOption("width","150px"))}var getTableData=function(){var deferred=$q.defer();return deferred.resolve(taskStatesCtrl.fReferences),deferred.promise};taskStatesCtrl.dtOptionsfReferences=DTOptionsBuilder.fromFnPromise((function(){return getTableData()})).withDOM("lTfgitp").withOption("createdRow",(function(row){$compile(angular.element(row).contents())($scope)})).withOption("scrollX",!1).withOption("lengthChange",!0).withOption("paging",!0).withOption("searching",!0).withOption("info",!0).withOption("caseInsensitive",!0).withOption("search",{caseInsensitive:!1}),taskStatesCtrl.dtInstanceCallbackfReferences=function(dtInstance){angular.isFunction(taskStatesCtrl.dtInstancefReferences)?taskStatesCtrl.dtInstancefReferences(dtInstance):angular.isDefined(taskStatesCtrl.dtInstancefReferences)&&(taskStatesCtrl.dtInstancefReferences=dtInstance)},null!=taskStatesCtrl.dtInstancefReferences.changeData&&taskStatesCtrl.dtInstancefReferences.changeData(getTableData()),taskStatesCtrl.loadingTableFailedReferences=!1},taskStatesCtrl.makeFailedEntitiesTable=function(isRoot,refreshData){if(refreshData&&taskStatesCtrl.dtInstancefEntities&&taskStatesCtrl.dtInstancefEntities.reloadData)return void taskStatesCtrl.dtInstancefEntities.reloadData((function(data){}),!1);taskStatesCtrl.dtInstancefEntities={},taskStatesCtrl.dtColumnsfEntities=[],taskStatesCtrl.dtColumnDefsfEntities=[],taskStatesCtrl.headersfEntities=isRoot?[{column:"sourceId",name:"Source id",clickAble:!0},{column:"targetId",name:"Target id",clickAble:!1},{column:"copyEntityStatus",name:"Entity Status",clickAble:!1},{column:"copyHierarchyStatus",name:"Hierarchy Data Status",clickAble:!1}]:[{column:"sourceId",name:"Source id",clickAble:!0},{column:"targetId",name:"Target id",clickAble:!1},{column:"parentLuName",name:"Parent LU Name",clickAble:!1},{column:"parentSourceId",name:"Parent Source ID",clickAble:!1},{column:"parentTargetId",name:"Parent Target ID",clickAble:!1},{column:"copyEntityStatus",name:"Entity Status",clickAble:!1},{column:"copyHierarchyStatus",name:"Hierarchy Data Status",clickAble:!1}];let clickableCol=(data,type,full)=>`<a ng-click="taskStatesCtrl.openStatsModal('${full.targetId}')">  ${data} </a>`;for(var i=0;i<taskStatesCtrl.headersfEntities.length;i++)taskStatesCtrl.headersfEntities[i].clickAble?taskStatesCtrl.dtColumnsfEntities.push(DTColumnBuilder.newColumn(taskStatesCtrl.headersfEntities[i].column).withTitle(taskStatesCtrl.headersfEntities[i].name).renderWith(clickableCol)):taskStatesCtrl.dtColumnsfEntities.push(DTColumnBuilder.newColumn(taskStatesCtrl.headersfEntities[i].column).withTitle(taskStatesCtrl.headersfEntities[i].name));var getTableData=function(){var deferred=$q.defer();return deferred.resolve(taskStatesCtrl.fEntities),deferred.promise};taskStatesCtrl.dtOptionsfEntities=DTOptionsBuilder.fromFnPromise((function(){return getTableData()})).withDOM("lTfgitp").withOption("createdRow",(function(row){$compile(angular.element(row).contents())($scope)})).withOption("scrollX",!1).withOption("lengthChange",!0).withOption("paging",!0).withOption("searching",!0).withOption("info",!0).withOption("caseInsensitive",!0).withOption("search",{caseInsensitive:!1,dt:function(){console.log("search")}}),taskStatesCtrl.dtInstanceCallbackfEntities=function(dtInstance){angular.isFunction(taskStatesCtrl.dtInstancefEntities)?taskStatesCtrl.dtInstancefEntities(dtInstance):angular.isDefined(taskStatesCtrl.dtInstancefEntities)&&(taskStatesCtrl.dtInstancefEntities=dtInstance)},null!=taskStatesCtrl.dtInstancefEntities.changeData&&taskStatesCtrl.dtInstancefEntities.changeData(getTableData()),taskStatesCtrl.loadingTableFailedEntities=!1},taskStatesCtrl.makeTables=function(isRoot,refreshData){taskStatesCtrl.makeCopiedReferenceTable(isRoot,refreshData),taskStatesCtrl.makeCopiedEntitiesTable(isRoot,refreshData),taskStatesCtrl.makeFailedReferenceTable(isRoot,refreshData),taskStatesCtrl.makeFailedEntitiesTable(isRoot,refreshData)};var body={taskExecutionId:taskStatesCtrl.tasksExecID};"EXTRACT"==taskStatesCtrl.type&&(taskStatesCtrl.refcount>0&&"REF"!==taskStatesCtrl.selectionMethod?body.fabricExecutionId=taskStatesCtrl.fabricExecID:0==taskStatesCtrl.refcount&&"REF"!==taskStatesCtrl.selectionMethod&&(body.fabricExecutionId=taskStatesCtrl.fabricExecID,delete body.taskExecutionId)),taskStatesCtrl.collapseNode=item=>{TDMService.getLUChildren({taskExecutionId:taskStatesCtrl.tasksExecID,lu_name:item.lu_name}).then(response=>{response.result.forEach((function(child){_.find(item.children,{lu_name:child.lu_name})||(item.children||(item.children=[]),item.children.push({lu_name:child.lu_name,children:[],collapsed:!0,hasChildren:child.count>0,errorInPath:!1,count:child.count}))}))})};let getTDMStats=(body,isRoot,luName)=>{body.type||(taskStatesCtrl.loadingTablesData=!0),TDMService.getTDMStats(body).then((function(response){if("SUCCESS"==response.errorCode){{let tableData=response.result.data;response.result.tableLevelInd?(taskStatesCtrl.tab=3,taskStatesCtrl.hideLogicalUnit=!0):response.result.luTree&&($scope.luTreeMenu=response.result.luTree,$scope.luTreeMenu[0]&&(taskStatesCtrl.selectedLU=$scope.luTreeMenu[0])),tableData?(tableData["Copied Reference per execution"]&&(body.type||(taskStatesCtrl.totalCopiedReference=tableData["Copied Reference per execution"].NoOfEntities),taskStatesCtrl.cReferences=tableData["Copied Reference per execution"].entitiesList,taskStatesCtrl.cReferencesTitle=""+$filter("translate")("COPIED_REF_TABLES")),tableData["Copied entities per execution"]&&(body.type||(taskStatesCtrl.totalCopiedEntities=tableData["Copied entities per execution"].NoOfEntities),taskStatesCtrl.cEntities=tableData["Copied entities per execution"].entitiesList,taskStatesCtrl.cEntitiesTitle=isRoot?$filter("translate")("COPIED_ENTITIES"):`${$filter("translate")("COPIED")} ${luName} ${$filter("translate")("LIST")}`),tableData["Failed Reference per execution"]&&(body.type||(taskStatesCtrl.totalFailedReference=tableData["Failed Reference per execution"].NoOfEntities),taskStatesCtrl.fReferences=tableData["Failed Reference per execution"].entitiesList,taskStatesCtrl.fReferencesTitle=""+$filter("translate")("FAILED_REF_TABLES")),tableData["Failed entities per execution"]&&(body.type||(taskStatesCtrl.totalFailedEntities=tableData["Failed entities per execution"].NoOfEntities),taskStatesCtrl.fEntities=tableData["Failed entities per execution"].entitiesList,taskStatesCtrl.fEntitiesTitle=isRoot?$filter("translate")("FAILED_ENTITIES"):`${$filter("translate")("FAILED")} ${luName} ${$filter("translate")("LIST")}`)):(taskStatesCtrl.totalCopiedReference=0,taskStatesCtrl.totalCopiedEntities=0,taskStatesCtrl.totalFailedReference=0,taskStatesCtrl.totalFailedEntities=0,taskStatesCtrl.fEntities=[],taskStatesCtrl.fReferences=[],taskStatesCtrl.cEntities=[],taskStatesCtrl.cReferences=[]),taskStatesCtrl.makeTables(isRoot,body.type)}body.type||(taskStatesCtrl.loadingTablesData=!1)}}))};getTDMStats(body,!0),taskStatesCtrl.updateTDMStats=(item,entityId,type)=>{for(i of(getTDMStats({taskExecutionId:taskStatesCtrl.tasksExecID,lu_name:item.lu_name,entityId:entityId,type:type},item.isRoot,item.lu_name),taskStatesCtrl.selectedLU.selected=!1,taskStatesCtrl.selectedLU=item,$scope.luTreeMenu))if(i.selected=!1,i.children)for(child of i.children)child.selected=!1},taskStatesCtrl.openTab=function(tab){taskStatesCtrl.tab=tab},taskStatesCtrl.searchText="",$element.on("search.dt",(function(e,api){taskStatesCtrl.searchText!=api.oPreviousSearch.sSearch&&(taskStatesCtrl.searchText=api.oPreviousSearch.sSearch,taskStatesCtrl.searchTimeout&&$timeout.cancel(taskStatesCtrl.searchTimeout),taskStatesCtrl.searchTimeout=$timeout((function(){taskStatesCtrl.updateTDMStats(taskStatesCtrl.selectedLU,taskStatesCtrl.searchText,{1:"Copied entities per execution",2:"Failed entities per execution",3:"Copied Reference per execution",4:"Failed Reference per execution"}[taskStatesCtrl.tab])}),1e3))}))},controllerAs:"taskStatesCtrl"}}angular.module("TDM-FE").directive("taskStatsDirective",taskStatsDirective);