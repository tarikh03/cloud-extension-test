function newLogicalUnitsDirective(){return{restrict:"E",templateUrl:"views/businessEntities/newLogicalUnits.html",scope:{data:"=",logicalUnits:"="},controller:function($scope,TDMService,BreadCrumbsService,toastr,$timeout){var newLogicalUnitsCtrl=this;newLogicalUnitsCtrl.attachedLogicalUnits=$scope.logicalUnits,TDMService.getGenericAPI("dataCenters").then((function(response){newLogicalUnitsCtrl.dataCenters=_.unique(response.result.filter(item=>"ALIVE"===item.status),"dc")})),TDMService.getLogicalUnits().then((function(response){newLogicalUnitsCtrl.logicalUnits=_.map(response.result,(function(lu){return{logical_unit:lu.lu_name,lu_parents:lu.lu_parents}})),_.remove(newLogicalUnitsCtrl.logicalUnits,(function(logicalUnit){return!!_.find(newLogicalUnitsCtrl.attachedLogicalUnits,{lu_name:logicalUnit.logical_unit})}));for(var i=0;i<newLogicalUnitsCtrl.logicalUnits.length;i++)newLogicalUnitsCtrl.parentLogicalUnits.push({logical_unit:newLogicalUnitsCtrl.logicalUnits[i].logical_unit})})),newLogicalUnitsCtrl.parentLogicalUnits=_.map(newLogicalUnitsCtrl.attachedLogicalUnits,(function(logicalUnit){return{logical_unit:logicalUnit.lu_name,lu_id:logicalUnit.lu_id}})),newLogicalUnitsCtrl.newLogicalUnits=[{}],newLogicalUnitsCtrl.addLogicalUnit=function(){newLogicalUnitsCtrl.newLogicalUnits.push({})},newLogicalUnitsCtrl.addLogicalUnits=function(){let newLogicalUnits=null;if("all"==newLogicalUnitsCtrl.chooseOption){if(0==newLogicalUnitsCtrl.logicalUnits.length)return void(newLogicalUnitsCtrl.logicalUnitAlert={type:"danger",msg:"There are no Logical Units to add"});newLogicalUnits=_.map(newLogicalUnitsCtrl.logicalUnits,(function(lu){return{lu_name:lu.logical_unit,lu_description:lu.logical_unit}}))}else{let parentCheck=!0;const parentError=[];if(newLogicalUnitsCtrl.newLogicalUnits.forEach(it=>{if(it&&it.lu_parent){const lu_parent_name=it.lu_parent;if(!newLogicalUnitsCtrl.newLogicalUnits.find(it=>it.lu_name.logical_unit===lu_parent_name)){newLogicalUnitsCtrl.attachedLogicalUnits.find(it=>it.lu_name===lu_parent_name)||(parentCheck=!1,parentError.push(lu_parent_name))}}}),!parentCheck)return void(newLogicalUnitsCtrl.logicalUnitAlert={type:"danger",msg:"The CRM parent LU is missing from the Business Entity (BE). \n                                                Add the CRM to the BE or set an alternative parent LU.\n                        "});newLogicalUnits=_.map(newLogicalUnitsCtrl.newLogicalUnits,(function(lu){return{lu_name:lu.lu_name.logical_unit,lu_description:lu.lu_description,lu_parent:{logical_unit:lu.lu_parent}}}))}TDMService.postLogicalUnits($scope.data.beId,$scope.data.beName,{logicalUnits:newLogicalUnits}).then((function(response){if("SUCCESS"==response.errorCode){for(var i=0;i<response.result.length;i++){var logicalUnit=response.result[i];newLogicalUnitsCtrl.attachedLogicalUnits.push({lu_dc_name:logicalUnit.lu_dc_name||"",lu_id:logicalUnit.lu_id,lu_name:logicalUnit.lu_name,lu_description:logicalUnit.lu_description||null,be_id:$scope.data.beId,lu_parent_id:logicalUnit&&logicalUnit.lu_parent&&logicalUnit.lu_parent.lu_id,lu_parent_name:logicalUnit&&logicalUnit.lu_parent&&logicalUnit.lu_parent.logical_unit||"",product_name:""})}$scope.data.reloadData(),newLogicalUnitsCtrl.close(),toastr.success("Logical units added successfully")}else newLogicalUnitsCtrl.logicalUnitAlert={type:"danger",msg:"failed to Add Logical Units ["+response.message+"]"}}))},newLogicalUnitsCtrl.deleteLogicalUnit=function(index){newLogicalUnitsCtrl.newLogicalUnits.splice(index,1)},newLogicalUnitsCtrl.closeAlert=function(){delete newLogicalUnitsCtrl.logicalUnitAlert},newLogicalUnitsCtrl.close=function(){$scope.data.close()}},controllerAs:"newLogicalUnitsCtrl"}}angular.module("TDM-FE").directive("newLogicalUnitsDirective",newLogicalUnitsDirective);