function taskVariableModal(){return{restrict:"E",templateUrl:"js/components/task/taskVariableModal/taskVariableModal.html",scope:{selectedVariables:"=",logicalUnits:"=",close:"=",variableData:"="},controller:function($scope,TDMService,AuthService,toastr){const taskVariableModalCtrl=this;$scope.variableData&&(taskVariableModalCtrl.edit=!0),console.log($scope.selectedVariables),TDMService.getAllGlobals({lus:_.map($scope.logicalUnits,"lu_name")}).then((function(response){taskVariableModalCtrl.allGlobals=[],response.result.forEach(global=>{const luObjectMapping={},selectedLuForGlobal=_.filter($scope.selectedVariables,{global_name:global.globalName});if(!selectedLuForGlobal.find(it=>"ALL"===it.lu_name)||$scope.variableData&&$scope.variableData.global_name===global.globalName){if(global.luList.forEach(luData=>{luObjectMapping[luData.luName]=luData.defaultValue}),void 0!==luObjectMapping.ALL&&null!==luObjectMapping.ALL){const newLuList=[];selectedLuForGlobal.length,0===selectedLuForGlobal.length&&newLuList.push({luName:"ALL",defaultValue:luObjectMapping.ALL}),$scope.logicalUnits.forEach(luData=>{newLuList.push({luName:luData.lu_name,defaultValue:luObjectMapping[luData.lu_name]||luObjectMapping.ALL||""})}),global.luList=newLuList}global.luList=global.luList.filter(lu=>selectedLuForGlobal.findIndex(it=>it.lu_name===lu.luName)<0),(0!==global.luList.length||$scope.variableData&&$scope.variableData.global_name===global.globalName)&&($scope.variableData&&!global.luList.find(it=>it.luName===$scope.variableData.lu_name)&&global.luList.push({luName:$scope.variableData.lu_name,defaultValue:$scope.variableData.global_value}),taskVariableModalCtrl.allGlobals.push(global))}}),$scope.variableData&&(taskVariableModalCtrl.global=_.find(taskVariableModalCtrl.allGlobals,{globalName:$scope.variableData.global_name}),taskVariableModalCtrl.global&&taskVariableModalCtrl.global.luList&&(taskVariableModalCtrl.filteredlogicalUnits=taskVariableModalCtrl.global.luList,taskVariableModalCtrl.logicalUnit=_.find(taskVariableModalCtrl.global.luList,{luName:$scope.variableData.lu_name})),taskVariableModalCtrl.globalValue=$scope.variableData.global_value)})),taskVariableModalCtrl.globalNameChange=()=>{taskVariableModalCtrl.global?taskVariableModalCtrl.filteredlogicalUnits=taskVariableModalCtrl.global.luList:taskVariableModalCtrl.filteredlogicalUnits=[],taskVariableModalCtrl.logicalUnit=null,taskVariableModalCtrl.globalValue=null},taskVariableModalCtrl.saveData=()=>{$scope.close({global_name:taskVariableModalCtrl.global.globalName,lu_name:taskVariableModalCtrl.logicalUnit.luName,global_value:taskVariableModalCtrl.globalValue,index:$scope.variableData&&$scope.variableData.index})}},controllerAs:"taskVariableModalCtrl"}}angular.module("TDM-FE").directive("taskVariableModal",taskVariableModal);