function additionalExecutionParameters(){return{restrict:"E",templateUrl:"js/components/task/tabs/additionalExecutionParameters/additionalExecutionParameters.html",scope:{content:"=",disableChange:"=",form:"=",disabled:"=",sourceEnvOwner:"=",targetEnvOwner:"=",back:"=",getSubTitle:"=",allowedEntityVersioning:"=",allowedRoleData:"=",allowedRoleDataSource:"="},controller:function($scope,TDMService,toastr,$timeout,AuthService,$state,DTOptionsBuilder,DTColumnBuilder,$q,$compile){var additionalExecutionParametersCtrl=this;if($scope.currentYear=(new Date).getFullYear(),TDMService.getTDMVersion().then(response=>{$scope.version=response.result}),additionalExecutionParametersCtrl.role=AuthService.getRole(),additionalExecutionParametersCtrl.taskData=$scope.content,additionalExecutionParametersCtrl.subTitle="",additionalExecutionParametersCtrl.generateTask=!1,additionalExecutionParametersCtrl.taskData.retention_period_value)try{additionalExecutionParametersCtrl.taskData.retention_period_value=parseInt(additionalExecutionParametersCtrl.taskData.retention_period_value)}catch(err){console.error(err)}additionalExecutionParametersCtrl.taskData.generateTask?(additionalExecutionParametersCtrl.generateTask=!0,"LOAD"===additionalExecutionParametersCtrl.taskData.task_type&&(additionalExecutionParametersCtrl.taskData.replace_sequences=!0),additionalExecutionParametersCtrl.entities=!0,additionalExecutionParametersCtrl.taskData.sync_mode=null):additionalExecutionParametersCtrl.taskData.source_synthetic&&(additionalExecutionParametersCtrl.taskData.sync_mode="OFF",additionalExecutionParametersCtrl.entities=!0),"EXTRACT"===additionalExecutionParametersCtrl.taskData.task_type&&"OFF"===additionalExecutionParametersCtrl.taskData.sync_mode&&(additionalExecutionParametersCtrl.taskData.sync_mode=null),TDMService.getRetentionPeriod().then(response=>{if(additionalExecutionParametersCtrl.retentionPeriod=angular.copy(response.result),additionalExecutionParametersCtrl.retentionPeriodReserve=angular.copy(response.result),additionalExecutionParametersCtrl.role&&"tester"===additionalExecutionParametersCtrl.role.type?(additionalExecutionParametersCtrl.retentionPeriod.retentionDefaultPeriod=additionalExecutionParametersCtrl.retentionPeriod.retentionPeriodForTesters,additionalExecutionParametersCtrl.retentionPeriod.retentionPeriodForTesters.allow_doNotDelete&&additionalExecutionParametersCtrl.retentionPeriod.periodTypes.unshift({name:"Do Not Delete"})):(additionalExecutionParametersCtrl.retentionPeriod.periodTypes.unshift({name:"Do Not Retain"}),additionalExecutionParametersCtrl.retentionPeriod.periodTypes.unshift({name:"Do Not Delete"})),_.remove(additionalExecutionParametersCtrl.retentionPeriod.periodTypes,(function(period){if(period.units>additionalExecutionParametersCtrl.retentionPeriod.maxRetentionPeriod.value)return!0})),_.remove(additionalExecutionParametersCtrl.retentionPeriodReserve.periodTypes,(function(period){if(period.units>additionalExecutionParametersCtrl.retentionPeriodReserve.maxReservationPeriod.value)return!0})),!("LOAD"===additionalExecutionParametersCtrl.taskData.task_type&&!additionalExecutionParametersCtrl.taskData.load_entity&&additionalExecutionParametersCtrl.taskData.delete_before_load||"RESERVE"===additionalExecutionParametersCtrl.taskData.task_type||"LOAD"===additionalExecutionParametersCtrl.taskData.task_type&&"OFF"===additionalExecutionParametersCtrl.taskData.sync_mode)){let firstTime=!0;additionalExecutionParametersCtrl.taskData.retention_period_value&&(firstTime=!1),"Do Not Retain"===additionalExecutionParametersCtrl.taskData.retention_period_type?additionalExecutionParametersCtrl.retention_period_type=additionalExecutionParametersCtrl.retentionPeriod.periodTypes[1]:"Do Not Delete"===additionalExecutionParametersCtrl.taskData.retention_period_type?additionalExecutionParametersCtrl.retention_period_type=additionalExecutionParametersCtrl.retentionPeriod.periodTypes[0]:additionalExecutionParametersCtrl.taskData.retention_period_type?(additionalExecutionParametersCtrl.retention_period_type=_.find(additionalExecutionParametersCtrl.retentionPeriod.periodTypes,{name:additionalExecutionParametersCtrl.taskData.retention_period_type}),additionalExecutionParametersCtrl.taskData.retention_period_value=parseFloat(additionalExecutionParametersCtrl.taskData.retention_period_value)):!additionalExecutionParametersCtrl.taskData.retention_period_type&&additionalExecutionParametersCtrl.retentionPeriod.retentionDefaultPeriod&&(additionalExecutionParametersCtrl.retention_period_type=_.find(additionalExecutionParametersCtrl.retentionPeriod.periodTypes,{name:additionalExecutionParametersCtrl.retentionPeriod.retentionDefaultPeriod.unit}),additionalExecutionParametersCtrl.taskData.retention_period_value=parseFloat(additionalExecutionParametersCtrl.retentionPeriod.retentionDefaultPeriod.value),additionalExecutionParametersCtrl.retentionPeriodTypeChanged())}("RESERVE"===additionalExecutionParametersCtrl.taskData.task_type||additionalExecutionParametersCtrl.taskData.reserve_ind)&&(additionalExecutionParametersCtrl.taskData.reserve_retention_period_type&&(additionalExecutionParametersCtrl.reserve_retention_period_type=_.find(additionalExecutionParametersCtrl.retentionPeriodReserve.periodTypes,{name:additionalExecutionParametersCtrl.taskData.reserve_retention_period_type}),additionalExecutionParametersCtrl.taskData.reserve_retention_period_value=parseFloat(additionalExecutionParametersCtrl.taskData.reserve_retention_period_value)),!additionalExecutionParametersCtrl.taskData.reserve_retention_period_type&&additionalExecutionParametersCtrl.retentionPeriodReserve.reservationDefaultPeriod&&(additionalExecutionParametersCtrl.reserve_retention_period_type=_.find(additionalExecutionParametersCtrl.retentionPeriodReserve.periodTypes,{name:additionalExecutionParametersCtrl.retentionPeriodReserve.reservationDefaultPeriod.unit}),additionalExecutionParametersCtrl.taskData.reserve_retention_period_value=parseFloat(additionalExecutionParametersCtrl.retentionPeriodReserve.reservationDefaultPeriod.value),additionalExecutionParametersCtrl.retentionPeriodTypeReserveChanged()))}),additionalExecutionParametersCtrl.taskData.syncModeRadio=null;var userRole=AuthService.getRole();additionalExecutionParametersCtrl.userRoleType=userRole.type,additionalExecutionParametersCtrl.subTitle=$scope.getSubTitle(),additionalExecutionParametersCtrl.retentionPeriodTypeChanged=function(){"Do Not Delete"===additionalExecutionParametersCtrl.retention_period_type.name?(additionalExecutionParametersCtrl.taskData.retention_period_type="Do Not Delete",additionalExecutionParametersCtrl.taskData.retention_period_value=-1):"Do Not Retain"===additionalExecutionParametersCtrl.retention_period_type.name?(additionalExecutionParametersCtrl.taskData.retention_period_type="Do Not Retain",additionalExecutionParametersCtrl.taskData.retention_period_value=0):additionalExecutionParametersCtrl.taskData.retention_period_type=additionalExecutionParametersCtrl.retention_period_type.name},additionalExecutionParametersCtrl.retentionPeriodTypeReserveChanged=function(){additionalExecutionParametersCtrl.taskData.reserve_retention_period_type=additionalExecutionParametersCtrl.reserve_retention_period_type.name},additionalExecutionParametersCtrl.checkDataTypeValidation=()=>{additionalExecutionParametersCtrl.taskData.reserve_ind||!additionalExecutionParametersCtrl.reference&&!additionalExecutionParametersCtrl.entities?additionalExecutionParametersCtrl.taskData.reserve_ind&&additionalExecutionParametersCtrl.entities?additionalExecutionParametersCtrl.valid="true":additionalExecutionParametersCtrl.valid="":additionalExecutionParametersCtrl.valid="true"},additionalExecutionParametersCtrl.versioningChange=()=>{additionalExecutionParametersCtrl.taskData.version_ind?additionalExecutionParametersCtrl.taskData.sync_mode="OFF":additionalExecutionParametersCtrl.taskData.sync_mode=null,additionalExecutionParametersCtrl.taskData.version_ind?(additionalExecutionParametersCtrl.retention_period_type=_.find(additionalExecutionParametersCtrl.retentionPeriod.periodTypes,{name:additionalExecutionParametersCtrl.retentionPeriod.versioningRetentionPeriod.unit}),additionalExecutionParametersCtrl.taskData.retention_period_value=parseFloat(additionalExecutionParametersCtrl.retentionPeriod.versioningRetentionPeriod.value),additionalExecutionParametersCtrl.retentionPeriodTypeChanged()):additionalExecutionParametersCtrl.retentionPeriod.retentionDefaultPeriod?(additionalExecutionParametersCtrl.retention_period_type=_.find(additionalExecutionParametersCtrl.retentionPeriod.periodTypes,{name:additionalExecutionParametersCtrl.retentionPeriod.retentionDefaultPeriod.unit}),additionalExecutionParametersCtrl.taskData.retention_period_value=parseFloat(additionalExecutionParametersCtrl.retentionPeriod.retentionDefaultPeriod.value),additionalExecutionParametersCtrl.retentionPeriodTypeChanged()):additionalExecutionParametersCtrl.taskData.retention_period_value=1},additionalExecutionParametersCtrl.dataTypeChange=()=>{additionalExecutionParametersCtrl.reference&&additionalExecutionParametersCtrl.entities?additionalExecutionParametersCtrl.taskData.reference="both":additionalExecutionParametersCtrl.reference&&!additionalExecutionParametersCtrl.entities?additionalExecutionParametersCtrl.taskData.reference="refernceOnly":additionalExecutionParametersCtrl.taskData.reference=null,"REF"===additionalExecutionParametersCtrl.taskData.selection_method&&"refernceOnly"!==additionalExecutionParametersCtrl.taskData.reference&&(additionalExecutionParametersCtrl.taskData.selection_method="L"),additionalExecutionParametersCtrl.checkDataTypeValidation()},additionalExecutionParametersCtrl.taskData.task_id?(additionalExecutionParametersCtrl.entities=!0,"refernceOnly"===additionalExecutionParametersCtrl.taskData.reference?(additionalExecutionParametersCtrl.reference=!0,additionalExecutionParametersCtrl.entities=!1):"both"===additionalExecutionParametersCtrl.taskData.reference&&(additionalExecutionParametersCtrl.reference=!0),additionalExecutionParametersCtrl.checkDataTypeValidation()):(additionalExecutionParametersCtrl.entities=!0,"refernceOnly"===additionalExecutionParametersCtrl.taskData.reference?(additionalExecutionParametersCtrl.reference=!0,additionalExecutionParametersCtrl.entities=!1):"both"===additionalExecutionParametersCtrl.taskData.reference&&(additionalExecutionParametersCtrl.reference=!0),additionalExecutionParametersCtrl.checkDataTypeValidation(),additionalExecutionParametersCtrl.taskData.sync_mode||(additionalExecutionParametersCtrl.taskData.sync_mode=null)),TDMService.getBEPostExecutionProcess(additionalExecutionParametersCtrl.taskData.be_id).then((function(response){"SUCCESS"==response.errorCode?(additionalExecutionParametersCtrl.taskData.allPostExecutionProcess=response.result,additionalExecutionParametersCtrl.allPostExecutionProcessIds=_.map(response.result,"process_id")):toastr.error("Business entity # "+additionalExecutionParametersCtrl.taskData.be_id,"Failed to get Post Execution Processes")}))},controllerAs:"additionalExecutionParametersCtrl"}}angular.module("TDM-FE").directive("additionalExecutionParameters",additionalExecutionParameters);